用户画像

​		用户画像就是通过收集用户的多个维度的数据，对用户的特征属性进行刻画，挖掘出潜在价值，抽象出用户的信息全貌，简单说就是将用户信息标签化。

​		我们做用户画像系统是因为公司想要以数据仓库为基础，做出推荐系统，营销系统，对用户精准投送。还用来寻找高价值用户，挽留待流失用户，提升用户活跃度。

- 人口属性
  - 自然特征：性别，年龄段，星座
  - 社会属性：所在省份，教育程度，职业

- 用户行为

  - 登录习惯：平均每日登录次数

  - 浏览习惯：平均浏览时长，7日内pv

  - 下单习惯：7日内下单次数，7日内下单金额，30日下单次数，30日下单金额
  - 支付习惯：支付工具，下单金额转化率

- 用户偏好

  - 品牌偏好：浏览偏好品牌，下单偏好品牌

  - 购买偏好：购买品类偏好

- 营销特征

​		RFM模型是衡量客户价值和客户创造利益能力的重要工具

​		用户价值分析: RFM模型：重要价值用户，重要挽回用户，重要发展用户

- 风险控制
  - 高风险：是否高投诉，是否高差评，是否高退货



​		平台：标签管理，流程任务管理，任务监控，用户分群

​		基于数据仓库，我们首先要做的就是对用户进行用户标签分级建模，然后根据标签定义加上自定义规则，从数仓中抽取计算。



​		我们先在用户画像管理平台填写标签任务，平台会把标签保存在数据库中，然后再将自定义规则的Spark jar包从平台上传到hdfs，在到达指定的时间后，平台会把标签任务生成待执行的任务进程，当满足优先级条件后，会把任务提交信息传给远端的任务提交器，提交器再把任务提交到yarn生成Spark作业，作业执行时会读取数据库中的标签定义，规则，sql，然后从Hive读取数据通过计算生成标签写入画像的标签表中，在作业提交后提交器会一直监控该作业的执行情况，通过回调传回画像平台用于监控。

sql的查询结果，必须是两列一列是uid ,一列是query_value



​		当所有标签任务执行完毕后，为了方便查询和导出，需要构建一张以用户ID为主键的宽表（先把所有标签表合并起来，然后通过pivot列转行将高表转换为宽表），然后添加到流程任务中，在标签任务执行完后启动，由于标签的使用场景一般是用户分群，需要即席查询，所系需要把宽表迁移到clickhouse（支持的数据量大，可以即席查询），在迁移到clickhouse后再把宽表转换成bitmap（存储成本低，天然去重，集合间运算快），然后添加到流程任务中，最后执行

关键词粒度的聚合汇总，ik分词器一对多，flink内置的无法满足，继承tablefunction实现分词逻辑，注册函数
